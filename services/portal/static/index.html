<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>VDE Admin Portal</title>
    <link rel="stylesheet" href="/static/style.css" />
  </head>
  <body>
    <div class="layout">
      <aside class="sidebar">
        <div class="brand">
          <div class="logo">VDE</div>
          <div class="brand-text">
            <div class="title">Admin</div>
            <div class="sub">Workspace Management</div>
          </div>
        </div>

        <nav class="nav">
          <button class="nav-item active" data-view="workspaces">Workspaces</button>
          <button class="nav-item" data-view="org">Org (Tenant/Project/User)</button>
          <button class="nav-item" data-view="sso">SSO/JWT</button>
          <button class="nav-item" data-view="policy">Policy (DLP/Upstream)</button>
          <button class="nav-item" data-view="gateway">Gateway Test</button>
        </nav>

        <div class="panel">
          <div class="panel-title">Admin Key</div>
          <input id="adminKey" class="input" type="password" placeholder="X-Admin-Key" />
          <div class="hint">키는 브라우저에 저장하지 않습니다(새로고침 시 재입력).</div>
        </div>
      </aside>

      <main class="main">
        <header class="header">
          <div class="hgroup">
            <h1 id="pageTitle">Workspaces</h1>
            <p id="pageDesc">code-server + opencode 컨셉의 워크스페이스를 관리합니다.</p>
          </div>
          <div class="actions">
            <button id="refreshBtn" class="btn">새로고침</button>
          </div>
        </header>

        <section id="view-workspaces" class="view">
          <div class="card">
            <div class="card-title">Create workspace</div>
            <div class="row">
              <input id="wsName" class="input" placeholder="Workspace name" />
              <input id="wsOwner" class="input" placeholder="Owner user_id (default: dev-user)" />
              <input id="wsProject" class="input" placeholder="Project id (default: dev-project)" />
              <button id="createBtn" class="btn primary">생성</button>
            </div>
          </div>

          <div class="card">
            <div class="card-title">Workspace list</div>
            <table class="table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Owner</th>
                  <th>Project</th>
                  <th>Status</th>
                  <th>URL</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="wsTbody"></tbody>
            </table>
          </div>
        </section>

        <section id="view-org" class="view hidden">
          <div class="card">
            <div class="card-title">Tenant</div>
            <div class="row">
              <input id="tenantName" class="input" placeholder="Tenant name" />
              <button id="tenantCreateBtn" class="btn primary">생성</button>
            </div>
            <pre id="tenantOut" class="pre"></pre>
          </div>

          <div class="card">
            <div class="card-title">Project</div>
            <div class="row">
              <input id="projectTenantId" class="input" placeholder="Tenant id" />
              <input id="projectName" class="input" placeholder="Project name" />
              <button id="projectCreateBtn" class="btn primary">생성</button>
            </div>
            <pre id="projectOut" class="pre"></pre>
          </div>

          <div class="card">
            <div class="card-title">User</div>
            <div class="row">
              <input id="userTenantId" class="input" placeholder="Tenant id" />
              <input id="userId" class="input" placeholder="user_id" />
              <input id="userDisplayName" class="input" placeholder="display name" />
              <input id="userRole" class="input" placeholder="role (admin/developer/viewer)" value="developer" />
              <button id="userCreateBtn" class="btn primary">생성</button>
            </div>
            <pre id="userOut" class="pre"></pre>
          </div>
        </section>

        <section id="view-sso" class="view hidden">
          <div class="card">
            <div class="card-title">Mock IdP: Token 발급</div>
            <div class="hint">PoC 목적: Gateway의 JWKS 기반 JWT 검증 흐름을 독립형으로 시연합니다.</div>
            <div class="row">
              <input id="idpSub" class="input" value="dev-user" placeholder="sub(user_id)" />
              <input id="idpTid" class="input" value="dev-tenant" placeholder="tid(tenant_id)" />
              <input id="idpPid" class="input" value="dev-project" placeholder="pid(project_id)" />
              <input id="idpWid" class="input" value="dev-workspace" placeholder="wid(workspace_id)" />
            </div>
            <div class="row">
              <input id="idpRole" class="input" value="admin" placeholder="role" />
              <input id="idpIss" class="input" value="vde-idp" placeholder="iss" />
              <input id="idpAud" class="input" value="vde-gateway" placeholder="aud" />
              <button id="idpIssueBtn" class="btn primary">발급</button>
            </div>
            <div class="row">
              <input id="issuedBearer" class="input" placeholder="Bearer token (auto-filled)" />
              <button id="copyBearerBtn" class="btn">Bearer 복사</button>
            </div>
            <pre id="idpOut" class="pre"></pre>
          </div>
        </section>

        <section id="view-policy" class="view hidden">
          <div class="card">
            <div class="card-title">Ops Key</div>
            <div class="row">
              <input id="opsKey" class="input" type="password" placeholder="X-Ops-Key (예: dev-ops-key)" />
              <input id="opsAuth" class="input" value="Bearer dev-admin" placeholder="Authorization (Bearer dev-admin or JWT)" />
            </div>
            <div class="hint">운영에서는 mTLS/mesh/RBAC 등으로 보호 권장. PoC에서는 최소 키 + admin role로 시연합니다.</div>
          </div>

          <div class="card">
            <div class="card-title">DLP rules (YAML)</div>
            <div class="row">
              <button id="dlpFetchBtn" class="btn">조회</button>
              <button id="dlpApplyBtn" class="btn primary">적용</button>
            </div>
            <textarea id="dlpYaml" class="textarea" rows="10"></textarea>
            <pre id="dlpOut" class="pre"></pre>
          </div>

          <div class="card">
            <div class="card-title">Upstream Auth</div>
            <div class="row">
              <button id="upFetchBtn" class="btn">조회</button>
              <select id="upMode" class="input">
                <option value="none">none</option>
                <option value="static_bearer">static_bearer</option>
              </select>
              <input id="upBearer" class="input" placeholder="upstream bearer token" value="upstream-dev-token" />
              <button id="upApplyBtn" class="btn primary">적용</button>
            </div>
            <pre id="upOut" class="pre"></pre>
          </div>
        </section>

        <section id="view-gateway" class="view hidden">
          <div class="card">
            <div class="card-title">Gateway quick test</div>
            <div class="row">
              <input id="gwPath" class="input" value="v1/chat" />
              <input id="gwAuth" class="input" value="Bearer dev" />
              <button id="gwSendBtn" class="btn primary">전송</button>
            </div>
            <textarea id="gwBody" class="textarea" rows="6">{ "messages":[{"role":"user","content":"hello"}] }</textarea>
            <pre id="gwOut" class="pre"></pre>
          </div>
        </section>
      </main>
    </div>

    <script src="/static/app.js"></script>
  </body>
</html>

